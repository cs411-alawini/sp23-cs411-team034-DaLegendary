"use strict";
var inherits = require('util').inherits;
var WrappedTask = require('./core/wrapped_task');


var RunTask = function (task, args, isAlias) {
	WrappedTask.call(this);
	this.task = task;
	this.args = args;
	this.isAlias = isAlias;
};
inherits(RunTask, WrappedTask);

RunTask.prototype.run = function (runner, ctx, cb) {
	var task = runner.tasks[this.task];
	if (task == null) {
		cb(new Error('Unknown task "' + this.task + '"'));
	}
	else {
		var args;
		if (this.isAlias) {
			args = ctx.args;
		}
		else {
			args = runner.subst(this.args, ctx);
		}
		runner.runTaskFunc(task, args, cb);
	}
};

RunTask.alias = function (task) {
	return new RunTask(task, null, true);
};

RunTask.call = function (task) {
	return new RunTask(task, Array.prototype.slice.call(arguments, 1));
};

RunTask.apply = function (task, args) {
	return new RunTask(task, args || []);
};


module.exports = RunTask;
